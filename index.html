<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carte Freebord - Les Bains</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map { height: 100vh; }
    .emoji-marker { font-size: 24px; line-height: 24px; text-align: center; }
    .leaflet-popup-content { font-size: 14px; }

    /* Boutons horizontaux */
    #buttonPanel {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
      display: flex;
      gap: 5px;
    }
    #buttonPanel button {
      background: white;
      border: 1px solid #ccc;
      padding: 5px 10px;
      cursor: pointer;
    }

    /* Fenêtres filtrage et ajout spot */
    #filterPanel, #addSpotPanel {
      position: absolute;
      top: 50px; /* décalé pour ne pas chevaucher les boutons */
      right: 10px;
      z-index: 1000;
      background: white;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
      display: none;
      max-width: 250px;
    }
    select, input { width: 100%; margin-bottom: 5px; }
    button { width: 100%; margin-top: 5px; }

    /* Filtres simples couleur */
    #filters {
      position: absolute;
      top: 50px;
      left: 10px;
      z-index: 1000;
      background: white;
      border: 1px solid #ccc;
      padding: 5px 10px;
    }
  </style>
</head>
<body>
  <div id="buttonPanel">
    <button id="filterBtn">Filtrer</button>
    <button id="addSpotBtn">Ajouter un spot</button>
    <button id="helpBtn">Help</button>
  </div>

  <div id="filterPanel">
    <label>Pays: <select id="filterCountry"><option value="">Tous</option></select></label>
    <label>Canton/Région: <select id="filterCanton"><option value="">Tous</option></select></label>
    <label>Ville: <select id="filterCity"><option value="">Toutes</option></select></label>
    <label>Difficulté: 
      <select id="filterDifficulty">
        <option value="">Toutes</option>
        <option value="bleu">Facile</option>
        <option value="rouge">Moyen</option>
        <option value="noir">Difficile</option>
      </select>
    </label>
    <button id="applyFilterBtn">Appliquer</button>
  </div>

  <div id="addSpotPanel">
    <label>Nom: <input type="text" id="spotName"></label>
    <label>Lien Google Maps du tracé: <input type="text" id="spotCoords" placeholder="https://www.google.com/maps/..."></label>
    <label>Ville: <input type="text" id="spotCity"></label>
    <label>Canton/Région: <input type="text" id="spotCanton"></label>
    <label>Pays: <input type="text" id="spotCountry"></label>
    <label>Difficulté: 
      <select id="spotDifficulty">
        <option value="bleu">Facile</option>
        <option value="rouge">Moyen</option>
        <option value="noir">Difficile</option>
      </select>
    </label>
    <label>Bitume (1-5): 
      <select id="spotBitume">
        <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
      </select>
    </label>
    <label>Trafic (1-5): 
      <select id="spotTraffic">
        <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
      </select>
    </label>
    <label>Vidéo (URL): <input type="text" id="spotVideo"></label>
    <button id="spotSendBtn">Envoyer</button>
  </div>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // --- Initialisation carte ---
    const map = L.map('map').setView([46.5191, 6.5668], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // --- Spots ---
    const spots = [
      {
        nom: "Les Bains",
        difficulte: "rouge",
        bitume: 4,
        trafic: 3,
        video: "https://www.youtube.com/embed/dQw4w9WgXcQ",
        lien: "https://maps.app.goo.gl/bXnBMYr7HbhJfJEc8",
        ville: "Lausanne",
        canton: "VD",
        pays: "Suisse",
        coordinates: [
          [46.51395,6.61827],[46.5139,6.61824],[46.51385,6.61822],[46.51332,6.61796],
          [46.51232,6.61746],[46.512,6.61732],[46.51192,6.61724],[46.51191,6.61723],
          [46.51187,6.61719],[46.51185,6.61716],[46.51183,6.61714]
        ]
      },
  {
    nom:"Montolivet",
    lat:46.514071, lng:6.639553,
    difficulte:"noir", bitume:3, trafic:1,
    video:"https://www.youtube.com/embed/dQw4w9WgXcQ",
    lien:"https://maps.app.goo.gl/4pbtwV3fMCweqjh5A",
    ville: "Lausanne",
        canton: "VD",
        pays: "Suisse",
    coordinates:[[46.5140863,6.6395701],[46.5139238,6.6395057],[46.5133221,6.6394252],[46.5130747,6.6393823],[46.5127831,6.6393233],[46.5124914,6.6392804]]
  },
  {
    nom:"Derrière les hôpitaux",
    lat:46.530979, lng:6.646186,
    difficulte:"bleu", bitume:3, trafic:2,
    video:"https://www.youtube.com/embed/ysz5S6PUM-U",
    lien:"https://maps.app.goo.gl/ZR52JcWtqaUND34k9",
    ville: "Lausanne",
        canton: "VD",
        pays: "Suisse",
  coordinates:[[46.5310463,6.6461827],[46.5300129,6.6461398],[46.5291641,6.6454854],[46.5284481,6.6452493],[46.5276288,6.6451635],[46.5262174,6.6449648],[46.5250363,6.645351],[46.5237519,6.6454369],[46.5223493,6.6460806],[46.5217439,6.6464668]]
  },
  {
    nom:"Les Poulets",
    lat:46.531547, lng:6.675879,
    difficulte:"noir", bitume:5, trafic:2,
    video:"https://www.youtube.com/watch?v=KU7fv4SWRQU",
    lien:"https://maps.app.goo.gl/UGEmvP7WUGthtcgr6",
    ville: "Pully",
        canton: "VD",
        pays: "Suisse",
    coordinates:[[46.53165,6.67598],[46.53152,6.67581],[46.53145,6.6757],[46.53143,6.67567],[46.53139,6.67562],[46.5313,6.67549],[46.53126,6.67544],[46.53118,6.67532],[46.53114,6.67527],[46.53109,6.67524],[46.53103,6.67521],[46.53099,6.6752],[46.53094,6.67518],[46.53081,6.67516],[46.53078,6.67515],[46.53062,6.6751],[46.53048,6.67507],[46.53043,6.67508],[46.53037,6.67509],[46.53028,6.67512],[46.53025,6.67514],[46.53001,6.67522],[46.5299,6.67525],[46.52982,6.67527],[46.52978,6.67526],[46.52976,6.67524],[46.52975,6.67521],[46.52972,6.67515],[46.52968,6.67505],[46.52963,6.67496],[46.52962,6.67494],[46.52957,6.67489],[46.52952,6.67487],[46.52949,6.67487],[46.52947,6.67487],[46.5294,6.67489],[46.52934,6.67493],[46.52928,6.67499],[46.52918,6.6751],[46.52916,6.67511],[46.52904,6.67521],[46.529,6.67524],[46.52893,6.67528],[46.52887,6.67529],[46.52883,6.67528],[46.52877,6.67524],[46.52871,6.67518],[46.52866,6.67513],[46.5286,6.67505],[46.52854,6.67496],[46.52851,6.67488],[46.52845,6.67474],[46.52841,6.67462],[46.52834,6.67451],[46.52823,6.67436],[46.52822,6.67435],[46.52807,6.6742],[46.52804,6.67418],[46.52791,6.67407],[46.52779,6.67398],[46.52763,6.67385],[46.5276,6.67382],[46.5275,6.67372],[46.52745,6.67367],[46.52726,6.67345],[46.52717,6.67334],[46.52712,6.67328],[46.52709,6.67323]]
  },

  // --- Fribourg ---
  {
    nom:"Canyon",
    lat:46.7860597, lng:7.1261238,
    difficulte:"bleu", bitume:4, trafic:1,
    video:"https://www.youtube.com/embed/dQw4w9WgXcQ",
    lien:"https://maps.app.goo.gl/GDVLAGQZjDzfKaK46",
    ville: "Villars-sur-Glâne",
        canton: "FR",
        pays: "Suisse",
    coordinates:[[46.78605,7.12614],[46.78606,7.12605],[46.78606,7.12597],[46.78606,7.12591],[46.78606,7.12577],[46.78606,7.12571],[46.78606,7.1256],[46.78604,7.12545],[46.78604,7.12542],[46.78601,7.12524],[46.78596,7.12501],[46.78587,7.12466],[46.7858,7.12442],[46.78578,7.12434],[46.78577,7.12427],[46.78576,7.12422],[46.78573,7.12394],[46.78571,7.12358],[46.78569,7.1229],[46.78569,7.12284],[46.78569,7.12264],[46.7857,7.12235],[46.7857,7.12185],[46.7857,7.12168],[46.78569,7.12161],[46.78565,7.12131],[46.78561,7.12111],[46.78561,7.1211],[46.78561,7.12109],[46.7856,7.12103],[46.78558,7.12085],[46.78553,7.12052],[46.7855,7.12033],[46.78549,7.12028],[46.78546,7.12009],[46.78544,7.12001],[46.7854,7.11982],[46.7854,7.11977],[46.78537,7.11958],[46.78532,7.11938],[46.78519,7.11884],[46.78517,7.11876],[46.78513,7.11858],[46.78512,7.11855],[46.78511,7.11851],[46.78508,7.11832],[46.78508,7.11825],[46.78507,7.11819],[46.78506,7.11813],[46.78505,7.11807],[46.78501,7.11781],[46.785,7.11773],[46.78492,7.11724],[46.78488,7.11705],[46.78487,7.11702],[46.78484,7.11688],[46.78476,7.11673]]
  },
  {
    nom:"La Côte",
    lat:46.739693, lng:7.079561,
    difficulte:"bleu", bitume:4, trafic:1,
    video:"https://www.youtube.com/embed/dQw4w9WgXcQ",
    lien:"https://maps.app.goo.gl/te7s9HRrVtx6AWxY8",
    ville: "Farvagny",
        canton: "FR",
        pays: "Suisse",
    coordinates:[[46.73931,7.07946],[46.73921,7.07942],[46.73855,7.07924],[46.73839,7.0792],[46.73828,7.07917],[46.73821,7.07915],[46.73786,7.07905],[46.73781,7.07904],[46.73771,7.07901],[46.73768,7.079],[46.73755,7.07897],[46.7375,7.07896],[46.73737,7.07893],[46.73718,7.07892],[46.73708,7.07891],[46.73696,7.07892],[46.73685,7.07892],[46.73679,7.07892],[46.73678,7.07892],[46.73631,7.07895],[46.73599,7.07897],[46.73589,7.07898],[46.73579,7.07897],[46.7357,7.07895],[46.7356,7.07893],[46.73551,7.07891],[46.7354,7.07891],[46.73526,7.07893],[46.73513,7.07894],[46.73504,7.07893],[46.73495,7.07888],[46.73486,7.0788],[46.73479,7.07868],[46.7347,7.07844],[46.73457,7.07789],[46.73456,7.07786],[46.7345,7.07765],[46.73447,7.07755],[46.73441,7.07742],[46.73437,7.07732],[46.73428,7.07709],[46.73424,7.07702]]
  },

  // --- Papi ---
  {
    nom:"Papi",
    lat:46.544850, lng:6.656507,
    difficulte:"bleu", bitume:3, trafic:2,
    video:"https://www.youtube.com/embed/dQw4w9WgXcQ",
    lien:"https://maps.app.goo.gl/5yzyrLoRmfjppUSk7",
    ville: "Lausanne",
        canton: "VD",
        pays: "Suisse",
    coordinates:[
      [46.54494,6.65655],[46.54479,6.65652],[46.54463,6.65651],[46.54446,6.65651],[46.54422,6.65652],
      [46.54420,6.65652],[46.54416,6.65652],[46.54409,6.65652],[46.54400,6.65649],[46.54390,6.65643],
      [46.54366,6.65627],[46.54359,6.65621],[46.54357,6.65616],[46.54356,6.65614],[46.54355,6.65613],
      [46.54354,6.65605],[46.54354,6.65593],[46.54354,6.65588],[46.54354,6.65573],[46.54353,6.65552],
      [46.54353,6.65538],[46.54350,6.65531],[46.54347,6.65525],[46.54342,6.65519],[46.54317,6.65500],
      [46.54310,6.65494],[46.54274,6.65466],[46.54271,6.65463],[46.54268,6.65455],[46.54269,6.65443],
      [46.54270,6.65419],[46.54273,6.65398],[46.54274,6.65393],[46.54275,6.65382],[46.54305,6.65367],
      [46.54312,6.65361],[46.54317,6.65351],[46.54320,6.65338],[46.54330,6.65267],[46.54332,6.65249],
      [46.54356,6.65088],[46.54358,6.65074],[46.54360,6.65060],[46.54361,6.65045],[46.54361,6.65023],
      [46.54360,6.65022],[46.54359,6.65006],[46.54353,6.64984],[46.54351,6.64972],[46.54350,6.64967],
      [46.54349,6.64952],[46.54349,6.64934],[46.54350,6.64921],[46.54352,6.64905],[46.54356,6.64889],
      [46.54361,6.64869],[46.54362,6.64864],[46.54364,6.64853],[46.54366,6.64845],[46.54368,6.64836],
      [46.54367,6.64820],[46.54363,6.64808],[46.54340,6.64822],[46.54338,6.64822],[46.54320,6.64831],
      [46.54288,6.64853],[46.54272,6.64866],[46.54262,6.64877],[46.54259,6.64883],[46.54245,6.64900],
      [46.54238,6.64908],[46.54216,6.64931],[46.54206,6.64941],[46.54196,6.64952],[46.54187,6.64962],
      [46.54181,6.64967],[46.54173,6.64973],[46.54164,6.64975],[46.54152,6.64977],[46.54140,6.64976],
      [46.54133,6.64974],[46.54120,6.64968],[46.54105,6.64958],[46.54090,6.64946],[46.54083,6.64942],
      [46.54065,6.64927],[46.54031,6.64897],[46.54010,6.64875],[46.54008,6.64873],[46.53992,6.64858],
      [46.53970,6.64834],[46.53967,6.64832],[46.53962,6.64830],[46.53948,6.64803],[46.53944,6.64799],
      [46.53924,6.64777],[46.53902,6.64752],[46.53878,6.64728],[46.53873,6.64723],[46.53863,6.64713],
      [46.53844,6.64695],[46.53818,6.64671],[46.53808,6.64650],[46.53801,6.64654],[46.53796,6.64657],
      [46.53792,6.64660],[46.53775,6.64673],[46.53761,6.64687],[46.53740,6.64717],[46.53705,6.64785],
      [46.53700,6.64793],[46.53695,6.64803],[46.53686,6.64823],[46.53684,6.64828],[46.53674,6.64846],
      [46.53660,6.64878],[46.53643,6.64857],[46.53597,6.64807],[46.53588,6.64797],[46.53583,6.64794],
      [46.53574,6.64787],[46.53558,6.64777],[46.53544,6.64769],[46.53513,6.64756],[46.53494,6.64748],
      [46.53478,6.64741],[46.53476,6.64740],[46.53462,6.64733],[46.53440,6.64725],[46.53435,6.64725],
      [46.53431,6.64724],[46.53415,6.64722],[46.53403,6.64720],[46.53400,6.64719],[46.53384,6.64717],
      [46.53378,6.64716],[46.53375,6.64710],[46.53372,6.64704],[46.53340,6.64692],[46.53337,6.64704],
      [46.53304,6.64687],[46.53314,6.64640],[46.53272,6.64619],[46.53258,6.64613],[46.53256,6.64613],
      [46.53244,6.64607],[46.53228,6.64674],[46.53227,6.64676],[46.53227,6.64677],[46.53226,6.64677],
      [46.53225,6.64678],[46.53224,6.64677],[46.53221,6.64676],[46.53184,6.64659],[46.53158,6.64646],[46.53133,6.64632],
      [46.53118,6.64620],[46.53118,6.64621],[46.53117,6.64621],[46.53117,6.64622],[46.53117,6.64623],[46.53116,6.64623],
      [46.53116,6.64624],[46.53115,6.64625],[46.53114,6.64625],[46.53114,6.64626],[46.53113,6.64626],[46.53112,6.64626],
      [46.53111,6.64626],[46.53110,6.64626],[46.53109,6.64625],[46.53109,6.64625],[46.53108,6.64624],[46.53107,6.64623],
      [46.53107,6.64623],[46.53106,6.64622],[46.53106,6.64621],[46.53105,6.64621]
    ]
  },

  // --- Béthusy ---
  {
    nom:"Béthusy",
    lat:46.521658, lng:6.646366,
    difficulte:"bleu", bitume:3, trafic:3.5,
    video:"https://www.youtube.com/embed/dQw4w9WgXcQ",
    lien:"https://maps.app.goo.gl/yto3Nq9PzUzBHvqw6",
    ville: "Lausanne",
        canton: "VD",
        pays: "Suisse",
    coordinates:[[46.52171,6.64655],[46.52169,6.64656],[46.52157,6.64629],[46.52148,6.64608],[46.52144,6.64596],[46.52131,6.64556],[46.52131,6.64555],[46.52124,6.64531],[46.52117,6.64498],[46.52114,6.64485],[46.52108,6.64455],[46.52105,6.64415],[46.52103,6.64371],[46.52103,6.64342],[46.52103,6.64338],[46.52104,6.64331],[46.52106,6.64288],[46.52107,6.64275],[46.52110,6.64239],[46.52111,6.64236],[46.52111,6.64230],[46.52112,6.64223],[46.52113,6.64215],[46.52118,6.64169],[46.52119,6.64158],[46.52120,6.64150],[46.52123,6.64123],[46.52125,6.64112],[46.52126,6.64103],[46.52128,6.64093],[46.52130,6.64085],[46.52131,6.64080],[46.52132,6.64076],[46.52133,6.64072],[46.52134,6.64067],[46.52136,6.64061],[46.52138,6.64054],[46.52141,6.64046],[46.52146,6.64039],[46.52154,6.64029],[46.52157,6.64026]]
  },

  // --- Tribunal ---
  {
    nom:"Tribunal",
    lat:46.521243, lng:6.646738,
    difficulte:"rouge", bitume:5, trafic:1,
    video:"https://www.youtube.com/embed/dQw4w9WgXcQ",
    lien:"https://maps.app.goo.gl/dKGS3isTpHi38MS68",
    ville: "Lausanne",
        canton: "VD",
        pays: "Suisse",
    coordinates:[[46.52135,6.64683],[46.52133,6.64684],[46.52127,6.64679],[46.52122,6.64674],[46.52115,6.64669],[46.52106,6.64662],[46.52088,6.64648],[46.52073,6.64632],[46.52055,6.64611],[46.52034,6.64585],[46.52023,6.64569],[46.52007,6.64552],[46.52001,6.64546],[46.51996,6.64544],[46.51991,6.64544],[46.51962,6.64544],[46.51959,6.64544],[46.51945,6.64544],[46.51933,6.64544],[46.51926,6.64544],[46.51924,6.64543],[46.51923,6.64543],[46.51919,6.64540],[46.51908,6.64533],[46.51892,6.64519],[46.51890,6.64517],[46.51876,6.64505],[46.51871,6.64500],[46.51825,6.64462],[46.51764,6.64414]]
  },
      {
       nom: "Calvaire",
  lat: 46.526755,
  lng: 6.641071,
  difficulte: "noir",
  bitume: 4,
  trafic: 0,
  video: "https://www.youtube.com/embed/dQw4w9WgXcQ", // Rick Astley 😅
  lien: "https://maps.app.goo.gl/zLPSWdmJjJVDmsPd7",
  pays: "Suisse",
  canton: "VD",
  ville: "Lausanne",
  coordinates: [
    [46.52679, 6.64116],
    [46.52666, 6.64094],
    [46.52665, 6.64092],
    [46.52653, 6.64074],
    [46.52653, 6.64073],
    [46.52642, 6.64054],
    [46.5263, 6.6403],
    [46.52623, 6.64015],
    [46.52616, 6.63996],
    [46.52612, 6.63988],
    [46.52608, 6.6398],
    [46.52604, 6.63973],
    [46.52599, 6.63963],
    [46.52589, 6.63943],
    [46.52577, 6.6392],
    [46.52573, 6.63911],
    [46.52569, 6.63901],
    [46.5256, 6.63878],
    [46.52549, 6.63844],
    [46.52547, 6.63834],
    [46.52547, 6.63824],
    [46.52548, 6.63822],
    [46.52549, 6.6382],
    [46.5256, 6.63799],
    [46.52561, 6.63797],
    [46.52562, 6.63795]
  ]
},
      {
  nom: "Trabandan",
  lat: 46.516338,
  lng: 6.641701,
  difficulte: "rouge",
  bitume: 4,
  trafic: 2,
  video: "", 
  lien: "https://maps.app.goo.gl/CFrLUQTC1QrDBTin7",
  pays: "Suisse",
  canton: "VD",
  ville: "Lausanne",
  coordinates: [
    [46.51635, 6.64172],
    [46.51613, 6.64162],
    [46.51610, 6.64162],
    [46.51606, 6.64163],
    [46.51602, 6.64165],
    [46.51599, 6.64168],
    [46.51582, 6.64186],
    [46.51559, 6.64210],
    [46.51532, 6.64246],
    [46.51508, 6.64278],
    [46.51494, 6.64298],
    [46.51491, 6.64303],
    [46.51486, 6.64318],
    [46.51471, 6.64364],
    [46.51453, 6.64412],
    [46.51452, 6.64415],
    [46.51451, 6.64416],
    [46.51442, 6.64421],
    [46.51437, 6.64425],
    [46.51426, 6.64431],
    [46.51406, 6.64438],
    [46.51395, 6.64440],
    [46.51386, 6.64442],
    [46.51367, 6.64446],
    [46.51362, 6.64447],
    [46.51359, 6.64447],
    [46.51350, 6.64450],
    [46.51344, 6.64453],
    [46.51331, 6.64466],
    [46.51301, 6.64506],
    [46.51290, 6.64519],
    [46.51288, 6.64521],
    [46.51282, 6.64523],
    [46.51274, 6.64524],
    [46.51270, 6.64524],
    [46.51268, 6.64525],
    [46.51266, 6.64526]
  ]
},
      {
  nom: "Rosiaz",
  lat: 46.521684,
  lng: 6.661826,
  difficulte: "bleu",
  bitume: 4,
  trafic: 2,
  video: "",
  lien: "https://maps.app.goo.gl/V4EBCkZUpCWuRa578",
  pays: "Suisse",
  canton: "VD",
  ville: "Pully",
  coordinates: [
    [46.52170, 6.66186],
    [46.52119, 6.66158],
    [46.52080, 6.66139],
    [46.52055, 6.66125],
    [46.51994, 6.66097],
    [46.51974, 6.66086],
    [46.51947, 6.66071],
    [46.51939, 6.66067],
    [46.51939, 6.66064],
    [46.51939, 6.66061],
    [46.51939, 6.66057],
    [46.51938, 6.66054],
    [46.51937, 6.66053],
    [46.51937, 6.66052],
    [46.51934, 6.66049],
    [46.51950, 6.66003],
    [46.51968, 6.65961],
    [46.51978, 6.65941],
    [46.51986, 6.65922],
    [46.51991, 6.65909],
    [46.51992, 6.65907]
  ]
},
      {
  nom: "Coudrette",
  lat: 46.522319,
  lng: 6.658607,
  difficulte: "rouge",
  bitume: 3,
  trafic: 1,
  video: "",
  lien: "https://maps.app.goo.gl/u9uqTc8MMuX5Xm396",
  pays: "Suisse",
  canton: "VD",
  ville: "Pully",
  coordinates: [
    [46.52235, 6.65863],
    [46.52227, 6.65860],
    [46.52222, 6.65859],
    [46.52220, 6.65859],
    [46.52211, 6.65859],
    [46.52201, 6.65857],
    [46.52191, 6.65855],
    [46.52184, 6.65850],
    [46.52178, 6.65846],
    [46.52176, 6.65844],
    [46.52175, 6.65843],
    [46.52170, 6.65840],
    [46.52163, 6.65835],
    [46.52154, 6.65828],
    [46.52152, 6.65827],
    [46.52148, 6.65822],
    [46.52142, 6.65818],
    [46.52137, 6.65815],
    [46.52130, 6.65818],
    [46.52125, 6.65821],
    [46.52120, 6.65823],
    [46.52114, 6.65824],
    [46.52109, 6.65823],
    [46.52095, 6.65816],
    [46.52091, 6.65817],
    [46.52034, 6.65793],
    [46.52027, 6.65825],
    [46.52019, 6.65855],
    [46.52011, 6.65879],
    [46.52007, 6.65894],
    [46.52004, 6.65896],
    [46.52003, 6.65898],
    [46.52001, 6.65899],
    [46.51996, 6.65900]
  ]
},
      {
  nom: "Ligne 48",
  lat: 46.519919,
  lng: 6.658997,
  difficulte: "rouge",
  bitume: 3,
  trafic: 2,
  video: "",
  lien: "https://maps.app.goo.gl/BpoHnP8W9L5VbZ3p6",
  pays: "Suisse",
  canton: "VD",
  ville: "Pully",
  coordinates: [
    [46.51992, 6.65902],
    [46.51992, 6.65896],
    [46.51991, 6.65893],
    [46.51989, 6.65885],
    [46.51984, 6.65873],
    [46.51959, 6.65824],
    [46.51940, 6.65789],
    [46.51936, 6.65766],
    [46.51936, 6.65765],
    [46.51935, 6.65764],
    [46.51934, 6.65752],
    [46.51931, 6.65733],
    [46.51930, 6.65725],
    [46.51928, 6.65719],
    [46.51925, 6.65713],
    [46.51920, 6.65707],
    [46.51911, 6.65699],
    [46.51902, 6.65692],
    [46.51893, 6.65686],
    [46.51891, 6.65682],
    [46.51888, 6.65678],
    [46.51885, 6.65672],
    [46.51886, 6.65671],
    [46.51887, 6.65668],
    [46.51888, 6.65666],
    [46.51888, 6.65664],
    [46.51888, 6.65663],
    [46.51888, 6.65662],
    [46.51888, 6.65658],
    [46.51886, 6.65656],
    [46.51886, 6.65655],
    [46.51885, 6.65654],
    [46.51883, 6.65652],
    [46.51882, 6.65651],
    [46.51880, 6.65651],
    [46.51878, 6.65652],
    [46.51876, 6.65653],
    [46.51875, 6.65655],
    [46.51875, 6.65656],
    [46.51874, 6.65657],
    [46.51874, 6.65658],
    [46.51874, 6.65660],
    [46.51866, 6.65660],
    [46.51863, 6.65659],
    [46.51834, 6.65659],
    [46.51805, 6.65657],
    [46.51777, 6.65655],
    [46.51774, 6.65655],
    [46.51768, 6.65656],
    [46.51768, 6.65653],
    [46.51768, 6.65652],
    [46.51767, 6.65650],
    [46.51766, 6.65648],
    [46.51765, 6.65647],
    [46.51763, 6.65647],
    [46.51762, 6.65646],
    [46.51761, 6.65646],
    [46.51760, 6.65646],
    [46.51758, 6.65647],
    [46.51757, 6.65648],
    [46.51756, 6.65649],
    [46.51755, 6.65651],
    [46.51754, 6.65653],
    [46.51754, 6.65654],
    [46.51744, 6.65652],
    [46.51717, 6.65646],
    [46.51685, 6.65637],
    [46.51675, 6.65634],
    [46.51667, 6.65633],
    [46.51661, 6.65632],
    [46.51652, 6.65633],
    [46.51626, 6.65633],
    [46.51594, 6.65638],
    [46.51590, 6.65638],
    [46.51569, 6.65642],
    [46.51553, 6.65645],
    [46.51544, 6.65649],
    [46.51533, 6.65655],
    [46.51523, 6.65658],
    [46.51517, 6.65660],
    [46.51511, 6.65660],
    [46.51499, 6.65658],
    [46.51494, 6.65656],
    [46.51492, 6.65654],
    [46.51489, 6.65651],
    [46.51486, 6.65643],
    [46.51484, 6.65638],
    [46.51483, 6.65631],
    [46.51483, 6.65618],
    [46.51485, 6.65531],
    [46.51485, 6.65521],
    [46.51487, 6.65498],
    [46.51489, 6.65476],
    [46.51491, 6.65456],
    [46.51493, 6.65439],
    [46.51495, 6.65439],
    [46.51496, 6.65438],
    [46.51498, 6.65436],
    [46.51498, 6.65435],
    [46.51499, 6.65433],
    [46.51500, 6.65431],
    [46.51500, 6.65429],
    [46.51500, 6.65425],
    [46.51500, 6.65423],
    [46.51499, 6.65422],
    [46.51499, 6.65421],
    [46.51498, 6.65420],
    [46.51497, 6.65419],
    [46.51496, 6.65419],
    [46.51494, 6.65418],
    [46.51493, 6.65418],
    [46.51491, 6.65419],
    [46.51490, 6.65420],
    [46.51489, 6.65422],
    [46.51488, 6.65423],
    [46.51487, 6.65425],
    [46.51487, 6.65427],
    [46.51487, 6.65430],
    [46.51466, 6.65428],
    [46.51457, 6.65427],
    [46.51452, 6.65424],
    [46.51444, 6.65422]
  ]
},
      {
  nom: "CHUV",
  lat: 46.530297,
  lng: 6.645273,
  difficulte: "rouge",
  bitume: 4,
  trafic: 4,
  video: "",
  lien: "https://maps.app.goo.gl/eobepfjpE5gKgzxc9",
  pays: "Suisse",
  canton: "VD",
  ville: "Lausanne",
  coordinates: [
    [46.53041, 6.64526],
    [46.53037, 6.64523],
    [46.53034, 6.64521],
    [46.53030, 6.64517],
    [46.53027, 6.64513],
    [46.52999, 6.64471],
    [46.52986, 6.64450],
    [46.52950, 6.64395],
    [46.52903, 6.64325],
    [46.52867, 6.64271],
    [46.52858, 6.64257],
    [46.52839, 6.64228],
    [46.52824, 6.64208],
    [46.52819, 6.64204],
    [46.52811, 6.64195],
    [46.52805, 6.64191],
    [46.52795, 6.64183],
    [46.52785, 6.64175],
    [46.52769, 6.64166],
    [46.52751, 6.64157],
    [46.52732, 6.64149],
    [46.52718, 6.64143],
    [46.52703, 6.64138],
    [46.52683, 6.64133],
    [46.52676, 6.64131],
    [46.52669, 6.64131],
    [46.52645, 6.64125],
    [46.52591, 6.64111],
    [46.52545, 6.64101],
    [46.52544, 6.64100],
    [46.52534, 6.64097],
    [46.52512, 6.64089],
    [46.52493, 6.64083],
    [46.52432, 6.64060],
    [46.52422, 6.64057],
    [46.52416, 6.64057],
    [46.52410, 6.64056],
    [46.52404, 6.64058],
    [46.52396, 6.64061],
    [46.52386, 6.64066],
    [46.52378, 6.64073],
    [46.52373, 6.64076],
    [46.52370, 6.64079],
    [46.52362, 6.64084],
    [46.52361, 6.64084],
    [46.52356, 6.64087],
    [46.52350, 6.64091],
    [46.52343, 6.64093],
    [46.52334, 6.64096],
    [46.52327, 6.64097],
    [46.52323, 6.64097],
    [46.52314, 6.64096],
    [46.52276, 6.64094],
    [46.52255, 6.64092],
    [46.52242, 6.64091],
    [46.52234, 6.64090],
    [46.52196, 6.64086],
    [46.52190, 6.64085],
    [46.52185, 6.64083],
    [46.52181, 6.64081],
    [46.52179, 6.64079],
    [46.52177, 6.64077],
    [46.52175, 6.64074],
    [46.52173, 6.64072],
    [46.52171, 6.64068],
    [46.52169, 6.64065],
    [46.52168, 6.64060],
    [46.52166, 6.64056],
    [46.52165, 6.64052],
    [46.52165, 6.64049],
    [46.52164, 6.64046],
    [46.52165, 6.64028]
  ]
}




    ];

    const polylines = {};
    const markers = {};

    function addSpotMarker(spot) {
      const emoji = spot.difficulte === "bleu" ? "🔵" : spot.difficulte === "rouge" ? "🔴" : "⚫";
      const marker = L.marker(spot.coordinates[0], {
        icon: L.divIcon({ className: 'emoji-marker', html: emoji, iconSize: [24,24] })
      }).addTo(map);

      marker.bindPopup(`
        <b>${spot.nom}</b><br>
        Bitume: ${'⭐'.repeat(spot.bitume)}<br>
        Trafic: ${'🚗'.repeat(spot.trafic)}<br>
        <a href="${spot.video}" target="_blank">Vidéo</a><br>
        <a href="${spot.lien}" target="_blank">Départ Google Maps</a>
      `);

      marker.on('click', () => {
        if(polylines[spot.nom]) {
          map.removeLayer(polylines[spot.nom]);
          delete polylines[spot.nom];
        } else {
          const color = spot.difficulte === "bleu" ? "#007bff" : spot.difficulte === "rouge" ? "#ff0000" : "#000000";
          polylines[spot.nom] = L.polyline(spot.coordinates, {color: color, weight: 4}).addTo(map);
        }
      });

      markers[spot.nom] = marker;
    }

    spots.forEach(addSpotMarker);

    // --- Centrer la carte sur tous les spots ---
const allCoords = [];
spots.forEach(s => {
  if (s.coordinates && s.coordinates.length > 0) {
    allCoords.push(...s.coordinates);
  } else if (s.polyline && s.polyline.length > 0) {
    allCoords.push(...s.polyline);
  } else if (s.lat && s.lng) {
    allCoords.push([s.lat, s.lng]);
  }
});

if (allCoords.length > 0) {
  map.fitBounds(allCoords);
}

    // --- Localisation en temps réel ---
map.locate({ setView: false, watch: true, maxZoom: 16 });

const userMarker = L.marker([0,0], {
  icon: L.divIcon({ className: 'emoji-marker', html: "📍", iconSize: [24,24] })
}).addTo(map);

map.on("locationfound", e => {
  userMarker.setLatLng(e.latlng);
});



    // --- Boutons ---
    const filterPanel = document.getElementById('filterPanel');
    const addSpotPanel = document.getElementById('addSpotPanel');

    document.getElementById('filterBtn').addEventListener('click', () => {
      filterPanel.style.display = filterPanel.style.display === 'none' ? 'block' : 'none';
    });

    document.getElementById('addSpotBtn').addEventListener('click', () => {
      addSpotPanel.style.display = addSpotPanel.style.display === 'none' ? 'block' : 'none';
    });

    document.getElementById('helpBtn').addEventListener('click', () => {
      window.location.href = 'mailto:fabricebeg1@gmail.com?subject=Aide Freebord';
    });

    // --- Filtres dynamiques ---
    function populateFilters() {
      const countrySet = new Set();
      const cantonSet = new Set();
      const citySet = new Set();
      spots.forEach(s => { countrySet.add(s.pays); cantonSet.add(s.canton); citySet.add(s.ville); });

      const fc = document.getElementById('filterCountry');
      const fct = document.getElementById('filterCanton');
      const fci = document.getElementById('filterCity');

      countrySet.forEach(c => { const o=document.createElement('option'); o.value=c;o.text=c; fc.add(o); });
      cantonSet.forEach(c => { const o=document.createElement('option'); o.value=c;o.text=c; fct.add(o); });
      citySet.forEach(c => { const o=document.createElement('option'); o.value=c;o.text=c; fci.add(o); });
    }
    populateFilters();

    document.getElementById('applyFilterBtn').addEventListener('click', () => {
      const country = document.getElementById('filterCountry').value;
      const canton = document.getElementById('filterCanton').value;
      const city = document.getElementById('filterCity').value;
      const difficulty = document.getElementById('filterDifficulty').value;

      spots.forEach(s => {
        const marker = markers[s.nom];
        const show = (country === "" || s.pays === country) &&
                     (canton === "" || s.canton === canton) &&
                     (city === "" || s.ville === city) &&
                     (difficulty === "" || s.difficulte === difficulty);
        if(show) marker.addTo(map);
        else { map.removeLayer(marker); if(polylines[s.nom]) { map.removeLayer(polylines[s.nom]); delete polylines[s.nom]; } }
      });
    });

    // --- Envoyer un spot ---
    document.getElementById('spotSendBtn').addEventListener('click', () => {
      const nom = document.getElementById('spotName').value;
      const coords = document.getElementById('spotCoords').value;
      const ville = document.getElementById('spotCity').value;
      const canton = document.getElementById('spotCanton').value;
      const pays = document.getElementById('spotCountry').value;
      const difficulte = document.getElementById('spotDifficulty').value;
      const bitume = document.getElementById('spotBitume').value;
      const trafic = document.getElementById('spotTraffic').value;
      const video = document.getElementById('spotVideo').value;

      const mailBody = `Nom: ${nom}\nLien Google Maps: ${coords}\nVille: ${ville}\nCanton/Région: ${canton}\nPays: ${pays}\nDifficulté: ${difficulte}\nBitume: ${bitume}\nTrafic: ${trafic}\nVidéo: ${video}`;
      window.location.href = `mailto:fabricebeg1@gmail.com?subject=Nouveau Spot Freebord&body=${encodeURIComponent(mailBody)}`;
    });

  </script>
</body>
</html>












