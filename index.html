<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Carte des Spots Freebord</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    body, html { margin:0; padding:0; height:100%; }
    #map { width:100%; height:100%; }

    /* Boutons */
    .custom-button {
      position: absolute;
      top: 10px;
      right: 10px;
      background: white;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      z-index: 1000;
    }
    .panel {
      display: none;
      position: absolute;
      top: 50px;
      right: 10px;
      background: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      z-index: 1000;
      max-width: 250px;
    }
    label { display:block; margin-top:5px; font-size:14px; }
    select, input { width:100%; margin-top:3px; }
    button { margin-top:10px; padding:6px 12px; }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- Bouton Filtre -->
  <div class="custom-button" onclick="togglePanel('filterPanel')">Filtres</div>
  <div id="filterPanel" class="panel">
    <h4>Filtrer les spots</h4>
    <label>Ville :
      <select id="filterVille"><option value="">Toutes</option></select>
    </label>
    <label>Canton/Région :
      <select id="filterCanton"><option value="">Tous</option></select>
    </label>
    <label>Pays :
      <select id="filterPays"><option value="">Tous</option></select>
    </label>
    <label>Difficulté :
      <select id="filterDifficulte">
        <option value="">Toutes</option>
        <option value="facile">Facile (bleu)</option>
        <option value="moyen">Moyen (rouge)</option>
        <option value="difficile">Difficile (noir)</option>
      </select>
    </label>
    <button onclick="applyFilters()">Appliquer</button>
  </div>

  <!-- Bouton Ajouter un spot -->
  <div class="custom-button" style="top:60px;" onclick="togglePanel('addPanel')">Ajouter un spot</div>
  <div id="addPanel" class="panel">
    <h4>Ajouter un spot</h4>
    <label>Nom du spot : <input type="text" id="spotNom"></label>
    <label>Pays : <input type="text" id="spotPays" value="Suisse"></label>
    <label>Canton/Région : <input type="text" id="spotCanton"></label>
    <label>Ville : <input type="text" id="spotVille"></label>
    <label>Difficulté :
      <select id="spotDifficulte">
        <option value="facile">Facile (bleu)</option>
        <option value="moyen">Moyen (rouge)</option>
        <option value="difficile">Difficile (noir)</option>
      </select>
    </label>
    <label>Qualité du bitume :
      <select id="spotBitume">
        <option value="1">⭐</option>
        <option value="2">⭐⭐</option>
        <option value="3">⭐⭐⭐</option>
        <option value="4">⭐⭐⭐⭐</option>
        <option value="5">⭐⭐⭐⭐⭐</option>
      </select>
    </label>
    <label>Trafic :
      <select id="spotTrafic">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
    </label>
    <label>Lien vidéo (YouTube) : <input type="text" id="spotVideo"></label>
    <label>Lien Google Maps (départ) : <input type="text" id="spotMaps"></label>
    <button onclick="envoyerSpot()">Envoyer</button>
  </div>

  <script>
    // Carte
    var map = L.map('map').setView([46.52, 6.63], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19
    }).addTo(map);

    // Localisation
    map.locate({setView:false, watch:true});
    function onLocationFound(e) {
      L.circleMarker(e.latlng, {radius:6, color:"blue"}).addTo(map)
        .bindPopup("Vous êtes ici");
    }
    map.on('locationfound', onLocationFound);

    // Exemple d’un spot
    var spots = [
      {
        nom:"Les Bains",
        ville:"Lausanne",
        canton:"Vaud",
        pays:"Suisse",
        difficulte:"moyen",
        bitume:4,
        trafic:2,
        video:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",
        maps:"https://maps.google.com"
      }
    ];

    var markers = [];
    var polylines = [];

    function couleur(d) {
      if(d==="facile") return "blue";
      if(d==="moyen") return "red";
      if(d==="difficile") return "black";
      return "gray";
    }

    function afficherSpots() {
      markers.forEach(m => map.removeLayer(m));
      polylines.forEach(p => map.removeLayer(p));
      markers = [];
      polylines = [];

      spots.forEach(s => {
        let marker = L.circleMarker([46.52, 6.63], {
          radius: 8,
          color: couleur(s.difficulte),
          fillColor: couleur(s.difficulte),
          fillOpacity: 1
        }).addTo(map);

        let popup = `<b>${s.nom}</b><br>
        ${s.ville}, ${s.canton}, ${s.pays}<br>
        Difficulté: ${s.difficulte}<br>
        Bitume: ${"⭐".repeat(s.bitume)}<br>
        Trafic: ${s.trafic}/5<br>
        <a href="${s.video}" target="_blank">Vidéo</a> | 
        <a href="${s.maps}" target="_blank">Google Maps</a>`;

        marker.bindPopup(popup);

        markers.push(marker);
      });
    }
    afficherSpots();

    // Filtres
    function applyFilters(){
      let v = document.getElementById("filterVille").value;
      let c = document.getElementById("filterCanton").value;
      let p = document.getElementById("filterPays").value;
      let d = document.getElementById("filterDifficulte").value;

      markers.forEach((m,i)=>{
        let s = spots[i];
        let visible = true;
        if(v && s.ville!==v) visible=false;
        if(c && s.canton!==c) visible=false;
        if(p && s.pays!==p) visible=false;
        if(d && s.difficulte!==d) visible=false;
        if(visible) map.addLayer(m); else map.removeLayer(m);
      });
    }

    // Toggle panels
    function togglePanel(id){
      let p = document.getElementById(id);
      p.style.display = (p.style.display==="block") ? "none" : "block";
    }

    // Envoyer un spot par mail
    function envoyerSpot(){
      let nom = document.getElementById("spotNom").value;
      let pays = document.getElementById("spotPays").value;
      let canton = document.getElementById("spotCanton").value;
      let ville = document.getElementById("spotVille").value;
      let difficulte = document.getElementById("spotDifficulte").value;
      let bitume = document.getElementById("spotBitume").value;
      let trafic = document.getElementById("spotTrafic").value;
      let video = document.getElementById("spotVideo").value;
      let maps = document.getElementById("spotMaps").value;

      let body = 
        `Nom: ${nom}%0D%0A`+
        `Pays: ${pays}%0D%0A`+
        `Canton/Région: ${canton}%0D%0A`+
        `Ville: ${ville}%0D%0A`+
        `Difficulté: ${difficulte}%0D%0A`+
        `Bitume: ${bitume}⭐%0D%0A`+
        `Trafic: ${trafic}/5%0D%0A`+
        `Vidéo: ${video}%0D%0A`+
        `Google Maps: ${maps}`;

      window.location.href = "mailto:tonmail@exemple.com?subject=Nouveau spot Freebord&body=" + body;
    }
  </script>
</body>
</html>
