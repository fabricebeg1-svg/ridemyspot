<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Carte Freebord</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { height: 100vh; }
        .emoji-marker {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            color: white;
            text-align: center;
            border: 2px solid white;
        }
    </style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // Initialisation de la carte
    const map = L.map('map').setView([46.51395, 6.61827], 15);

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Spot ‚ÄúLes Bains‚Äù
    const spot = {
        nom: "Les Bains",
        difficulte: "rouge",
        bitume: 4,
        trafic: 3,
        video: "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
        lien: "https://maps.app.goo.gl/bXnBMYr7HbhJfJEc8",
        coords: [
            [46.51395,6.61827],[46.5139,6.61824],[46.51385,6.61822],[46.51332,6.61796],[46.51232,6.61746]
        ]
    };

    // Fonction pour cr√©er un marqueur rond avec emoji
    function createEmojiMarker(latlng, color, emoji) {
        const icon = L.divIcon({
            className: 'emoji-marker',
            html: emoji,
            iconSize: [32, 32],
            iconAnchor: [16, 16],
            popupAnchor: [0, -16],
            style: `background-color:${color}`
        });
        return L.marker(latlng, { icon });
    }

    // Couleur selon la difficult√©
    const colorMap = { bleu: '#1E90FF', rouge: '#FF0000', noir: '#000000' };
    const emojiMap = { bleu: 'üîµ', rouge: 'üî¥', noir: '‚ö´' };

    // Cr√©ation du marqueur
    const marker = createEmojiMarker(spot.coords[0], colorMap[spot.difficulte], emojiMap[spot.difficulte]);
    marker.addTo(map);

    // Cr√©ation du trac√©
    const polyline = L.polyline(spot.coords, { color: colorMap[spot.difficulte], weight: 4 });
    let polyVisible = false;

    // Popup avec infos
    const popupHTML = `
        <b>${spot.nom}</b><br>
        Difficult√©: ${spot.difficulte} ${emojiMap[spot.difficulte]}<br>
        Bitume: ${spot.bitume}/5<br>
        Trafic: ${spot.trafic}/5<br>
        <a href="${spot.video}" target="_blank">Vid√©o YouTube</a><br>
        <a href="${spot.lien}" target="_blank">Point de d√©part Google Maps</a>
    `;
    marker.bindPopup(popupHTML);

    // Click pour afficher/cacher le trac√©
    marker.on('click', () => {
        if (!polyVisible) {
            polyline.addTo(map);
            polyVisible = true;
        } else {
            map.removeLayer(polyline);
            polyVisible = false;
        }
    });

    // Position en direct sans recentrer la carte
    if (navigator.geolocation) {
        navigator.geolocation.watchPosition(
            (pos) => {
                const lat = pos.coords.latitude;
                const lng = pos.coords.longitude;
                if (!window.userMarker) {
                    window.userMarker = L.circleMarker([lat, lng], {
                        radius: 8,
                        color: 'green',
                        fillColor: 'green',
                        fillOpacity: 0.8
                    }).addTo(map).bindPopup('Votre position');
                } else {
                    window.userMarker.setLatLng([lat, lng]);
                }
            },
            (err) => console.warn(err),
            { enableHighAccuracy: true }
        );
    }
</script>
</body>
</html>
